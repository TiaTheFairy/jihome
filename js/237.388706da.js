"use strict";(self["webpackChunkjihome_front"]=self["webpackChunkjihome_front"]||[]).push([[237],{237:function(t,s,e){e.r(s),e.d(s,{default:function(){return p}});var i=function(){var t=this,s=t._self._c;return s("div",[s("div",[s("el-card",{staticClass:"card",attrs:{shadow:"hover"}},[s("el-divider",{staticClass:"divider",attrs:{"content-position":"right"},on:{click:t.backNewsList}},[s("div",{staticClass:"back"},[s("el-image",{staticClass:"backIcon",attrs:{src:e(7596)}}),s("span",{staticClass:"backWord"},[t._v(t._s(t.$t("News.NewReturn")))])],1)]),s("div",{staticClass:"new"},[s("div",{staticClass:"title"},[s("el-input",{staticClass:"inputBox",attrs:{placeholder:this.$t("News.NewTitle"),minlength:"2",maxlength:"16"},model:{value:t.title,callback:function(s){t.title=s},expression:"title"}})],1),s("div",{staticClass:"detail"},[s("el-input",{staticClass:"inputBox",attrs:{placeholder:this.$t("News.NewDetail"),type:"textarea",resize:"none",rows:"3"},model:{value:t.detail,callback:function(s){t.detail=s},expression:"detail"}})],1),s("div",{staticClass:"uploadPic"},t._l(t.picture,(function(e){return s("div",{key:e.id,staticClass:"pictureList"},[s("div",{staticClass:"pictureItem"},[s("el-upload",{staticClass:"uploader",attrs:{action:"server.default.uploadImg","show-file-list":!1,"http-request":t.uploadPicture,"before-upload":t.beforePictureUpload}},[e.link?s("img",{staticClass:"uploadImage",attrs:{src:e.link}}):s("i",{staticClass:"el-icon-plus uploadIcon"}),e.link?s("i",{staticClass:"el-icon-close removeIcon",on:{click:function(s){return s.stopPropagation(),t.removePicture(e.id)}}}):t._e()])],1)])})),0),s("div",{staticClass:"link"},[s("el-input",{staticClass:"inputBox",attrs:{placeholder:this.$t("News.NewLink")},model:{value:t.link,callback:function(s){t.link=s},expression:"link"}})],1),s("div",{staticClass:"user"},[s("div",{staticClass:"userauth userItem"},[s("span",[t._v(t._s(t.$t("News.NewUser")))]),s("span",{staticClass:"userRight"},[t._v(t._s(t.userShow))])]),s("div",{staticClass:"school userItem"},[s("span",[t._v(t._s(t.$t("News.NewSchool")))]),s("span",{staticClass:"userRight"},[s("el-checkbox",{attrs:{label:t.$t("User.UserSchool0"),disabled:!t.schoolAllow},model:{value:t.school[0],callback:function(s){t.$set(t.school,0,s)},expression:"school[0]"}}),s("el-checkbox",{attrs:{label:t.$t("User.UserSchool1"),disabled:!t.schoolAllow},model:{value:t.school[1],callback:function(s){t.$set(t.school,1,s)},expression:"school[1]"}}),s("el-checkbox",{attrs:{label:t.$t("User.UserSchool2"),disabled:!t.schoolAllow},model:{value:t.school[2],callback:function(s){t.$set(t.school,2,s)},expression:"school[2]"}}),s("el-checkbox",{attrs:{label:t.$t("User.UserSchool3"),disabled:!t.schoolAllow},model:{value:t.school[3],callback:function(s){t.$set(t.school,3,s)},expression:"school[3]"}})],1)])]),s("div",{staticClass:"buttons"},[s("el-button",{staticClass:"button",attrs:{type:"primary"},on:{click:t.submit}},[t._v(t._s(t.$t("News.NewConfirm")))])],1)])],1)],1)])},a=[],l=(e(7658),e(4161)),o=e(680),r=e(1780),c=e(691);const n=(0,c.kP)("1234567890",9);var h={name:"news-new",data(){return{title:"",detail:"",link:"",user:"",userShow:"",school:[!1,!1,!1,!1],schoolAllow:!1,picture:[{id:0,link:null}],pictureRaw:[],idCount:0}},methods:{backNewsList(){this.$bus.$emit("showNewsList")},getUser(){const t=this.loading();(0,l.Z)({method:"post",url:r.Z.user,data:new URLSearchParams({type:"me",cookie:o.Z.get("loginAs")})}).then((s=>{t.close(),200!=s.status?this.alert(this.$t("System.NetworkIssue"),this.$t("System.Error")):"USER_NOMATCH"==s.data?this.alert(this.$t("System.IllegalRequest"),this.$t("System.Error")):"USER_FOUND"==s.data.status?s.data.userstatus>=2?(this.user=this.formatUserType(s.data.userstatus,s.data.authname),this.userShow=this.user,this.school[s.data.school]=!0,s.data.userstatus>2&&(this.schoolAllow=!0)):(this.$alert(this.$t("System.IllegalRequest"),this.$t("System.Error")),this.$bus.$emit("showNewsList")):this.alert("Unexpected Response!",this.$t("System.Error"))}))},submit(){const t=/(https?:\/\/)?(([0-9a-z.]+\.[a-z]+)|(([0-9]{1,3}\.){3}[0-9]{1,3}))(:[0-9]+)?(\/[0-9a-z%/.\-_]*)?(\?[0-9a-z=&%_-]*)?(#[0-9a-z=&%_-]*)?/gi;if(this.title.length<5||this.title.length>16||this.detail.length<10||this.detail.length>300)this.alert(this.$t("News.NewInputLengthBad"),this.$t("System.Warning"));else if(0==this.school.filter((t=>t)).length)this.alert(this.$t("News.NewNoSchool"),this.$t("System.Warning"));else if(t.test(this.link)){const t=this.loading();for(let s in this.picture)null!=this.picture[s].link&&this.pictureRaw.push(this.picture[s].link.substr(this.picture[s].link.indexOf("/img")));(0,l.Z)({method:"post",url:r.Z.postNews,data:new URLSearchParams({cookie:o.Z.get("loginCookie"),userauth:this.user,newsid:n(),title:this.title,content:this.detail,school:JSON.stringify(this.school),link:this.link,picture:this.pictureRaw})}).then((s=>{if(t.close(),200!=s.status)this.alert(this.$t("System.NetworkIssue"),this.$t("System.Error"));else{if("NEWS_NEWSID_TAKEN"==s.data)return void this.submit();"NEWS_POST_COMPLETE"==s.data.status&&(this.$bus.$emit("refreshNewsList"),this.alert(this.$t("News.NewCompleteJump"),this.$t("News.NewComplete"),(()=>{this.$bus.$emit("showNewsDetail",s.data.newsid)})))}}))}else this.alert(this.$t("News.NewLinkBad"),this.$t("System.Warning"))},uploadPicture(t){const s=this.loading();let e=new FormData;e.append("file",t.file),e.append("type","news"),e.append("cookie",o.Z.get("loginAs")),(0,l.Z)({method:"post",url:r.Z.uploadImg,data:e}).then((t=>{s.close(),200!=t.status?this.alert(this.$t("System.NetworkIssue"),this.$t("System.Error")):"IMAGE_UPLOAD_SUCCESS"==t.data.status&&(this.picture.splice(this.picture.length-1,1),this.picture.push({id:this.idCount,link:r.Z.server+t.data.id}),this.idCount++,this.picture.length<3&&this.picture.push({id:this.idCount,link:null}))}))},beforePictureUpload(t){return!(this.picture.length>3)&&("image/jpeg"!=t.type&&"image/png"!=t.type?(this.alert(this.$t("News.PictureWrongType"),this.$t("System.Warning")),!1):!(t.size/1024/1024>2)||(this.alert(this.$t("News.PictureTooLarge"),this.$t("System.Warning")),!1))},removePicture(t){let s=!1,e="";for(let a in this.picture)this.picture[a].id==t&&(e=this.picture[a].link,this.picture.splice(a,1)),this.picture[a]&&null==this.picture[a].link&&(s=!0);s||this.picture.push({id:this.idCount,link:null});const i=this.loading();(0,l.Z)({method:"post",url:r.Z.removeImg,data:new URLSearchParams({target:e})}).then((t=>{i.close(),200!=t.status&&this.alert(this.$t("System.NetworkIssue"),this.$t("System.Error"))}))}},mounted(){this.getUser()}},u=h,d=e(1001),A=(0,d.Z)(u,i,a,!1,null,"7ff42c52",null),p=A.exports},7596:function(t){t.exports="data:image/png;base64,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"}}]);
//# sourceMappingURL=237.388706da.js.map