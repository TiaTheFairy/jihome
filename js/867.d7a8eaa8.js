"use strict";(self["webpackChunkjihome_front"]=self["webpackChunkjihome_front"]||[]).push([[867],{2867:function(t,s,e){e.r(s),e.d(s,{default:function(){return v}});var a=function(){var t=this,s=t._self._c;return s("div",[s("div",{staticClass:"userme"},[s("div",{staticClass:"myInfo"},[t._v(t._s(t.$t("User.UserMe")))]),s("div",{staticClass:"avatar infoItem"},[s("el-avatar",{attrs:{size:100,src:t.avatar,shape:"square"}}),s("el-button",{staticClass:"edit",attrs:{type:"primary"},on:{click:t.newAvatar}},[t._v(t._s(t.$t("User.Upload")))])],1),s("div",{staticClass:"infos"},[s("div",{staticClass:"infoItem"},[s("span",{staticClass:"infoLeft"},[t._v(t._s(t.$t("User.UserID")))]),s("span",{staticClass:"infoRight uneditable"},[t._v(t._s(t.userid))])]),s("div",{staticClass:"infoItem"},[s("span",{staticClass:"infoLeft"},[t._v(t._s(t.$t("User.Nickname")))]),s("span",{staticClass:"infoRight editable",on:{click:t.changeNickname}},[t._v(t._s(t.nickname))])]),s("div",{staticClass:"infoItem"},[s("span",{staticClass:"infoLeft"},[t._v(t._s(t.$t("User.Email")))]),s("span",{staticClass:"infoRight uneditable"},[t._v(t._s(t.email))])]),s("div",{staticClass:"infoItem"},[s("span",{staticClass:"infoLeft"},[t._v(t._s(t.$t("User.RealName")))]),s("span",{staticClass:"infoRight uneditable"},[t._v(t._s(t.realname))])]),s("div",{staticClass:"infoItem"},[s("span",{staticClass:"infoLeft"},[t._v(t._s(t.$t("User.StudentID")))]),s("span",{staticClass:"infoRight uneditable"},[t._v(t._s(t.studentid))])]),s("div",{staticClass:"infoItem"},[s("span",{staticClass:"infoLeft"},[t._v(t._s(t.$t("User.School")))]),s("span",{staticClass:"infoRight uneditable"},[t._v(t._s(t.school))])]),s("div",{staticClass:"infoItem"},[s("span",{staticClass:"infoLeft"},[t._v(t._s(t.$t("User.Password")))]),s("span",{staticClass:"infoRight editable",on:{click:t.changePassword}},[t._v(t._s(t.password))])]),s("div",{staticClass:"infoItem"},[s("span",{staticClass:"infoLeft"},[t._v(t._s(t.$t("User.Auth")))]),t.authAllowed?s("span",{staticClass:"infoRight editable",on:{click:t.changeAuth}},[t._v(t._s(t.userType))]):t._e(),t.authAllowed?t._e():s("span",{staticClass:"infoRight uneditable"},[t._v(t._s(t.userType))])]),s("div",{staticClass:"infoItem"},[s("span",{staticClass:"infoLeft"},[t._v(t._s(t.$t("User.Purse")))]),s("span",{staticClass:"infoRight editable",on:{click:t.changePurse}},[t._v("ï¿¥"+t._s(t.purse))])])]),s("div",{staticClass:"buttons"},[s("el-button",{staticClass:"aButton",attrs:{type:"danger"},on:{click:t.logout}},[t._v(t._s(t.$t("User.Logout")))])],1)]),s("el-dialog",{staticClass:"dialog",attrs:{title:this.$t("User.EdittingInfo"),visible:t.isEditting,"append-to-body":"",width:"80%"},on:{"update:visible":function(s){t.isEditting=s}}},[s("div",[s("div",{directives:[{name:"show",rawName:"v-show",value:"nickname"==t.edittingItem,expression:'edittingItem == "nickname"'}],staticClass:"changeNickname"},[s("el-input",{staticClass:"inputBox",attrs:{placeholder:t.$t("User.NewNickname")},model:{value:t.newNickname,callback:function(s){t.newNickname=s},expression:"newNickname"}})],1),s("div",{directives:[{name:"show",rawName:"v-show",value:"password"==t.edittingItem,expression:'edittingItem == "password"'}],staticClass:"changePassword"},[s("el-input",{staticClass:"inputBox",attrs:{placeholder:t.$t("User.OldPassword")},model:{value:t.oldPassword,callback:function(s){t.oldPassword=s},expression:"oldPassword"}}),s("el-input",{staticClass:"inputBox",attrs:{placeholder:t.$t("User.NewPassword")},model:{value:t.newPassword,callback:function(s){t.newPassword=s},expression:"newPassword"}}),s("el-input",{staticClass:"inputBox",attrs:{placeholder:t.$t("User.NewPasswordConfirm")},model:{value:t.newPasswordConfirm,callback:function(s){t.newPasswordConfirm=s},expression:"newPasswordConfirm"}})],1),s("div",{directives:[{name:"show",rawName:"v-show",value:"auth"==t.edittingItem,expression:'edittingItem == "auth"'}],staticClass:"changeAuth"},[s("div",{staticClass:"select"},[s("span",[t._v(t._s(t.$t("User.AuthType")))]),s("el-select",{staticClass:"selectBox",model:{value:t.authType,callback:function(s){t.authType=s},expression:"authType"}},[s("el-option",{attrs:{label:t.$t("User.AuthTypePerson"),value:"1",disabled:""}}),s("el-option",{attrs:{label:t.$t("User.AuthType2"),value:"2"}}),s("el-option",{attrs:{label:t.$t("User.AuthType3"),value:"3"}})],1)],1),s("el-input",{staticClass:"inputBox",attrs:{placeholder:t.$t("User.AuthName")},model:{value:t.authName,callback:function(s){t.authName=s},expression:"authName"}})],1)]),s("div",{staticClass:"edittingFooter",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(s){t.isEditting=!1}}},[t._v(t._s(t.$t("System.Cancel")))]),s("el-button",{attrs:{type:"primary"},on:{click:function(s){return t.confirmEditting()}}},[t._v(t._s(t.$t("System.Confirm")))])],1)]),s("el-dialog",{staticClass:"doingPurse",attrs:{title:this.$t("User.Purse"),visible:t.doingPurse,"append-to-body":""},on:{"update:visible":function(s){t.doingPurse=s}}},[s("el-tabs",[s("el-tab-pane",{attrs:{label:this.$t("User.PurseTake")}},[s("el-input",{staticClass:"input",attrs:{placeholder:t.$t("User.PurseTakeAmount"),type:"number",max:this.purse},on:{input:t.calTakePurse},model:{value:t.pursetake,callback:function(s){t.pursetake=s},expression:"pursetake"}}),s("div",{staticClass:"label"},[t._v(t._s(t.$t("User.PurseTakeGet"))+": "+t._s(t.pursetakereal))]),s("div",{staticClass:"button"},[s("el-button",{attrs:{type:"primary"},on:{click:function(s){return t.purseCheck(0)}}},[t._v(t._s(t.$t("User.PurseTakeGo")))])],1)],1),s("el-tab-pane",{attrs:{label:this.$t("User.PurseAdd")}},[s("el-input",{staticClass:"input",attrs:{placeholder:t.$t("User.PurseAdd"),type:"number",max:500},model:{value:t.purseadd,callback:function(s){t.purseadd=s},expression:"purseadd"}}),s("div",{staticClass:"button"},[s("el-button",{attrs:{type:"primary"},on:{click:function(s){return t.purseCheck(1)}}},[t._v(t._s(t.$t("User.PurseAddGo")))])],1)],1)],1)],1),s("el-dialog",{staticClass:"avatarUploader",attrs:{title:this.$t("User.AvatarTitle"),visible:t.uploadingAvatar,"append-to-body":"",width:"80%"},on:{"update:visible":function(s){t.uploadingAvatar=s}}},[s("el-upload",{staticClass:"uploader",attrs:{action:"server.default.uploadImg","show-file-list":!1,"http-request":t.uploadAvatar,"before-upload":t.beforeAvatarUpload}},[t.uploadingAvatarUrl?s("img",{staticClass:"avatarImage",attrs:{src:t.uploadingAvatarUrl}}):s("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),s("div",{staticClass:"avatarWarn"},[t._v(t._s(this.$t("User.AvatarWarn")))])],1)],1)},i=[],r=e(4161),n=e(680),o=e(1780),l=e(9702),h=e.n(l),d=e(691);const u=(0,d.kP)("1234567890",9);var c={name:"user-me",data(){return{isEditting:!1,edittingItem:"",doingPurse:!1,newNickname:"",newPassword:"",newPasswordConfirm:"",oldPassword:"",authAllowed:!1,authType:"",authName:"",avatar:"",userid:"",nickname:"",email:"",realname:"",studentid:"",school:"",password:"********",userType:"",purse:0,pursetake:0,pursetakereal:0,purseadd:0,uploadingAvatar:!1,uploadingAvatarUrl:""}},methods:{uploadAvatar(t){const s=this.loading();let e=new FormData;e.append("file",t.file),e.append("type","user"),e.append("cookie",n.Z.get("loginAs")),(0,r.Z)({method:"post",url:o.Z.uploadImg,data:e}).then((t=>{s.close(),200!=t.status?this.alert(this.$t("System.NetworkIssue"),this.$t("System.Error")):"IMAGE_UPLOAD_SUCCESS"==t.data&&this.alert(this.$t("User.AvatarSuccess"),this.$t("System.Info"),(()=>{this.redirect("userMe")}))}))},beforeAvatarUpload(t){return"image/jpeg"!=t.type&&"image/png"!=t.type?(this.alert(this.$t("User.AvatarWrongType"),this.$t("System.Warning")),!1):!(t.size/1024/1024>2)||(this.alert(this.$t("User.AvatarTooLarge"),this.$t("System.Warning")),!1)},changeNickname(){this.isEditting=!0,this.edittingItem="nickname"},changePassword(){this.isEditting=!0,this.edittingItem="password"},changeAuth(){this.isEditting=!0,this.edittingItem="auth"},confirmEditting(){if("nickname"==this.edittingItem)if(this.newNickname.length<3||this.newNickname.length>10)this.alert(this.$t("User.NewNicknameBad"),this.$t("System.Warning"));else{const t=this.loading();(0,r.Z)({method:"post",url:o.Z.changeUsername,data:new URLSearchParams({nickname:this.newNickname,cookie:n.Z.get("loginAs")})}).then((s=>{t.close(),200!=s.status?this.alert(this.$t("System.NetworkIssue"),this.$t("System.Error")):"UPDATE_USERNAME_TAKEN"==s.data?this.alert(this.$t("User.NewNicknameTaken"),this.$t("System.Warning")):"UPDATE_USERNAME_OK"==s.data?this.alert(this.$t("User.NewInfoComplete"),this.$t("System.Info"),(()=>{n.Z.remove("loginAs"),n.Z.remove("loginCookie"),location.href=location.origin})):this.alert("Unexpected Response!",this.$t("System.Error"))}))}else if("password"==this.edittingItem)if(this.newPassword.length<8||this.newPassword.length>16)this.alert(this.$t("User.NewPasswordBad"),this.$t("System.Error"));else if(this.newPassword!=this.newPasswordConfirm)this.alert(this.$t("User.NewPasswordWrong"),this.$t("System.Error"));else{const t=this.loading();(0,r.Z)({method:"post",url:o.Z.changePwd,data:new URLSearchParams({oldPassword:h()(this.oldPassword),password:h()(this.newPasswordConfirm),cookie:n.Z.get("loginAs")})}).then((s=>{t.close(),200!=s.status?this.alert(this.$t("System.NetworkIssue"),this.$t("System.Error")):"UPDATE_PASSWORD_NOMATCH"==s.data?this.alert(this.$t("User.OldPasswordWrong"),this.$t("System.Warning")):"UPDATE_PASSWORD_OK"==s.data?this.alert(this.$t("User.NewInfoComplete"),this.$t("System.Info"),(()=>{n.Z.remove("loginAs"),n.Z.remove("loginCookie"),location.href=location.origin})):this.alert("Unexpected Response!",this.$t("System.Error"))}))}else if("auth"==this.edittingItem)if(""==this.authType||""==this.authName)this.alert(this.$t("User.AuthInputBad"),this.$t("System.Error"));else{const t=this.loading();(0,r.Z)({method:"post",url:o.Z.newAdminWork,data:new URLSearchParams({workid:u(),type:1,cookie:n.Z.get("loginAs"),authtype:this.authType,content:this.authName})}).then((s=>{if(t.close(),200!=s.status)this.alert(this.$t("System.NetworkIssue"),this.$t("System.Error"));else{if("ADMINWORK_WORKID_TAKEN"==s.data)return void this.confirmEditting();"ADMINWORK_NEW_COMPLETE"==s.data?this.alert(this.$t("User.AuthSubmitted"),this.$t("System.Info")):this.alert("Unexpected Response!",this.$t("System.Error"))}}))}this.isEditting=!1},logout(){this.$confirm(this.$t("User.LogoutConfirm"),this.$t("System.Warning"),{confirmButtonText:this.$t("System.Yes"),cancelButtonText:this.$t("System.No"),type:"warning"}).then((()=>{n.Z.remove("loginAs"),n.Z.remove("loginCookie"),location.href=location.origin})).catch((()=>{}))},getUserInfo(){const t=this.loading();(0,r.Z)({method:"post",url:o.Z.user,data:new URLSearchParams({type:"me",cookie:n.Z.get("loginAs")})}).then((s=>{t.close(),200!=s.status?this.alert(this.$t("System.NetworkIssue"),this.$t("System.Error")):"USER_NOMATCH"==s.data?this.alert(this.$t("System.IllegalRequest"),this.$t("System.Error")):"USER_FOUND"==s.data.status?(this.userid=s.data.userid,this.nickname=s.data.username,this.email=s.data.email,this.realname=s.data.realname,this.studentid=s.data.studentid,this.school=this.$t("User.UserSchool"+s.data.school),this.userType=this.formatUserType(s.data.userstatus,s.data.authname),this.avatar=this.getUserAvatar(this.userid),1==s.data.userstatus?this.authAllowed=!0:this.authAllowed=!1):this.alert("Unexpected Response!",this.$t("System.Error"))}))},getPurse(){const t=this.loading();(0,r.Z)({method:"post",url:o.Z.getPurse,data:new URLSearchParams({cookie:n.Z.get("loginAs")})}).then((s=>{t.close(),200!=s.status?this.alert(this.$t("System.NetworkIssue"),this.$t("System.Error")):"USER_NOMATCH"==s.data?this.alert(this.$t("System.IllegalRequest"),this.$t("System.Error")):"TRADE_GETPURSE_COMPLETE"==s.data.status?this.purse=s.data.purse.toFixed(2):this.alert("Unexpected Response!",this.$t("System.Error"))}))},calTakePurse(){this.pursetakereal=(.98*this.pursetake).toFixed(2)},changePurse(){this.doingPurse=!0},purseCheck(t){if(0==t)if(parseFloat(this.pursetakereal)>parseFloat(this.purse))this.alert(this.$("User.PurseNotEnough"),this.$t("System.Warning"));else if(this.pursetakereal<.98)this.alert(this.$("User.PurseTakeFew"),this.$t("System.Warning"));else{const t=this.loading();(0,r.Z)({method:"post",url:o.Z.takePurse,data:new URLSearchParams({cookie:n.Z.get("loginAs"),amount:this.pursetakereal})}).then((s=>{t.close(),200!=s.status?this.alert(this.$t("System.NetworkIssue"),this.$t("System.Error")):"USER_NOMATCH"==s.data?this.alert(this.$t("System.IllegalRequest"),this.$t("System.Error")):"TRADE_TAKEPURSE_LEAK"==s.data.status?(this.getPurse(),this.doingPurse=!1,this.alert(this.$("User.PurseNotEnough"),this.$t("System.Warning"))):"TRADE_TAKEPURSE_COMPLETE"==s.data.status?(this.getPurse(),this.doingPurse=!1,this.alert(this.$("User.PurseTakeComplete"),this.$t("System.Info"))):this.alert("Unexpected Response!",this.$t("System.Error"))}))}else if(1==t)if(this.purseadd>500)this.alert(this.$("User.PurseAddMuch"),this.$t("System.Warning"));else{const t=this.loading();(0,r.Z)({method:"post",url:o.Z.addPurse,data:new URLSearchParams({cookie:n.Z.get("loginAs"),amount:this.purseadd})}).then((s=>{t.close(),200!=s.status?this.alert(this.$t("System.NetworkIssue"),this.$t("System.Error")):"USER_NOMATCH"==s.data?this.alert(this.$t("System.IllegalRequest"),this.$t("System.Error")):"TRADE_ADDPURSE_COMPLETE"==s.data.status?(this.getPurse(),this.doingPurse=!1,this.alert(this.$("User.PurseAddComplete"),this.$t("System.Info"))):this.alert("Unexpected Response!",this.$t("System.Error"))}))}},newAvatar(){this.uploadingAvatar=!0}},mounted(){n.Z.get("loginAs")?(this.getUserInfo(),this.getPurse()):this.goLogin()}},m=c,p=e(1001),g=(0,p.Z)(m,a,i,!1,null,"68505e5c",null),v=g.exports}}]);
//# sourceMappingURL=867.d7a8eaa8.js.map